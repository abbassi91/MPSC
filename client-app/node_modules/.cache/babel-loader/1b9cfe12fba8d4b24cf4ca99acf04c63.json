{"ast":null,"code":"import _initializerDefineProperty from \"/Users/abdelilah/Desktop/App/client-app/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _applyDecoratedDescriptor from \"/Users/abdelilah/Desktop/App/client-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"/Users/abdelilah/Desktop/App/client-app/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper\";\n\nvar _dec, _class, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _descriptor15, _temp;\n\nimport { observable, action, computed, runInAction, reaction } from 'mobx';\nimport agent from '../api/agent';\nimport { setAffilieProps } from '../common/util/util';\nimport { HubConnectionBuilder, LogLevel } from '@aspnet/signalr';\nconst LIMIT = 2;\nlet AffilieStore = (_dec = observable.ref, (_class = (_temp = class AffilieStore {\n  constructor(rootStore) {\n    this.rootStore = void 0;\n\n    _initializerDefineProperty(this, \"affilieRegistry\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"affilie\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"loadingInitial\", _descriptor3, this);\n\n    _initializerDefineProperty(this, \"submitting\", _descriptor4, this);\n\n    _initializerDefineProperty(this, \"target\", _descriptor5, this);\n\n    _initializerDefineProperty(this, \"loading\", _descriptor6, this);\n\n    _initializerDefineProperty(this, \"hubConnection\", _descriptor7, this);\n\n    _initializerDefineProperty(this, \"affilieCount\", _descriptor8, this);\n\n    _initializerDefineProperty(this, \"page\", _descriptor9, this);\n\n    _initializerDefineProperty(this, \"predicate\", _descriptor10, this);\n\n    _initializerDefineProperty(this, \"setPredicate\", _descriptor11, this);\n\n    _initializerDefineProperty(this, \"setPage\", _descriptor12, this);\n\n    _initializerDefineProperty(this, \"createHubConnection\", _descriptor13, this);\n\n    _initializerDefineProperty(this, \"stopHubConnection\", _descriptor14, this);\n\n    _initializerDefineProperty(this, \"loadAffilies\", _descriptor15, this);\n\n    this.rootStore = rootStore;\n    reaction(() => this.predicate.keys(), () => {\n      this.page = 0;\n      this.affilieRegistry.clear();\n      this.loadAffilies();\n    });\n  }\n\n  get axiosParams() {\n    const params = new URLSearchParams();\n    params.append('limit', String(LIMIT));\n    params.append('offset', \"\".concat(this.page ? this.page * LIMIT : 0));\n    this.predicate.forEach((value, key) => {\n      if (key === 'startDate') {\n        params.append(key, value.toISOString());\n      } else {\n        params.append(key, value);\n      }\n    });\n    return params;\n  }\n\n  get totalPages() {\n    return Math.ceil(this.affilieCount / LIMIT);\n  }\n\n  get affiliesByDate() {\n    return this.groupAffiliesByDate(Array.from(this.affilieRegistry.values()));\n  }\n\n  groupAffiliesByDate(affilies) {\n    const sortedAffilies = affilies;\n    return Object.entries(sortedAffilies.reduce((affilies, affilie) => {\n      const date = affilie.DateNaissance.toISOString().split('T')[0];\n      affilies[date] = affilies[date] ? [...affilies[date], affilie] : [affilie];\n      return affilies;\n    }, {}));\n  }\n\n}, _temp), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"affilieRegistry\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return new Map();\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"affilie\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return null;\n  }\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"loadingInitial\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor4 = _applyDecoratedDescriptor(_class.prototype, \"submitting\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor5 = _applyDecoratedDescriptor(_class.prototype, \"target\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return '';\n  }\n}), _descriptor6 = _applyDecoratedDescriptor(_class.prototype, \"loading\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor7 = _applyDecoratedDescriptor(_class.prototype, \"hubConnection\", [_dec], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return null;\n  }\n}), _descriptor8 = _applyDecoratedDescriptor(_class.prototype, \"affilieCount\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0;\n  }\n}), _descriptor9 = _applyDecoratedDescriptor(_class.prototype, \"page\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0;\n  }\n}), _descriptor10 = _applyDecoratedDescriptor(_class.prototype, \"predicate\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return new Map();\n  }\n}), _descriptor11 = _applyDecoratedDescriptor(_class.prototype, \"setPredicate\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return (predicate, value) => {\n      this.predicate.clear();\n\n      if (predicate !== 'all') {\n        this.predicate.set(predicate, value);\n      }\n    };\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"axiosParams\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"axiosParams\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"totalPages\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"totalPages\"), _class.prototype), _descriptor12 = _applyDecoratedDescriptor(_class.prototype, \"setPage\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return page => {\n      this.page = page;\n    };\n  }\n}), _descriptor13 = _applyDecoratedDescriptor(_class.prototype, \"createHubConnection\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return () => {\n      this.hubConnection = new HubConnectionBuilder().withUrl(process.env.REACT_APP_API_CHAT_URL, {\n        accessTokenFactory: () => this.rootStore.commonStore.token\n      }).configureLogging(LogLevel.Information).build();\n      this.hubConnection.start().then(() => console.log(this.hubConnection.state)).catch(error => console.log('Error establishing connection: ', error));\n    };\n  }\n}), _descriptor14 = _applyDecoratedDescriptor(_class.prototype, \"stopHubConnection\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return () => {\n      this.hubConnection.stop();\n    };\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"affiliesByDate\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"affiliesByDate\"), _class.prototype), _descriptor15 = _applyDecoratedDescriptor(_class.prototype, \"loadAffilies\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async () => {\n      this.loadingInitial = true;\n\n      try {\n        const affiliesEnvelope = await agent.Affilies.list(this.axiosParams);\n        const affilies = affiliesEnvelope.affilies,\n              affilieCount = affiliesEnvelope.affilieCount;\n        runInAction('loading affilies', () => {\n          affilies.forEach(affilie => {\n            setAffilieProps(affilie, this.rootStore.userStore.user);\n            this.affilieRegistry.set(affilie.Cin, affilie);\n          });\n          this.affilieCount = affilieCount;\n          this.loadingInitial = false;\n        });\n      } catch (error) {\n        runInAction('load affilies error', () => {\n          this.loadingInitial = false;\n        });\n      }\n    };\n  }\n})), _class));\nexport { AffilieStore as default };","map":{"version":3,"sources":["/Users/abdelilah/Desktop/App/client-app/src/app/stores/affiliesStore.ts"],"names":["observable","action","computed","runInAction","reaction","agent","setAffilieProps","HubConnectionBuilder","LogLevel","LIMIT","AffilieStore","ref","constructor","rootStore","predicate","keys","page","affilieRegistry","clear","loadAffilies","axiosParams","params","URLSearchParams","append","String","forEach","value","key","toISOString","totalPages","Math","ceil","affilieCount","affiliesByDate","groupAffiliesByDate","Array","from","values","affilies","sortedAffilies","Object","entries","reduce","affilie","date","DateNaissance","split","Map","set","hubConnection","withUrl","process","env","REACT_APP_API_CHAT_URL","accessTokenFactory","commonStore","token","configureLogging","Information","build","start","then","console","log","state","catch","error","stop","loadingInitial","affiliesEnvelope","Affilies","list","userStore","user","Cin"],"mappings":"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","sourcesContent":["import { observable, action, computed, runInAction, reaction } from 'mobx';\n\nimport agent from '../api/agent';\nimport { RootStore } from './rootStore';\nimport { setAffilieProps } from '../common/util/util';\nimport { HubConnection, HubConnectionBuilder, LogLevel } from '@aspnet/signalr';\nimport { IAffilie } from '../models/affilie';\n\nconst LIMIT = 2;\n\nexport default class AffilieStore {\n  rootStore: RootStore;\n  constructor(rootStore: RootStore) {\n    this.rootStore = rootStore;\n\n    reaction(\n      () => this.predicate.keys(),\n      () => {\n        this.page = 0;\n        this.affilieRegistry.clear();\n        this.loadAffilies();\n      }\n    )\n  }\n\n  @observable affilieRegistry = new Map();\n  @observable affilie: IAffilie | null = null;\n  @observable loadingInitial = false;\n  @observable submitting = false;\n  @observable target = '';\n  @observable loading = false;\n  @observable.ref hubConnection: HubConnection | null = null;\n  @observable affilieCount = 0;\n  @observable page = 0;\n  @observable predicate = new Map();\n\n  @action setPredicate = (predicate: string, value: string | Date) => {\n    this.predicate.clear();\n    if (predicate !== 'all') {\n      this.predicate.set(predicate, value);\n    }\n  }\n\n  @computed get axiosParams() {\n    const params = new URLSearchParams();\n    params.append('limit', String(LIMIT));\n    params.append('offset', `${this.page ? this.page * LIMIT : 0}`);\n    this.predicate.forEach((value, key) => {\n      if (key === 'startDate') {\n        params.append(key, value.toISOString())\n      } else {\n        params.append(key, value)\n      }\n    })\n    return params;\n  }\n\n  @computed get totalPages() {\n    return Math.ceil(this.affilieCount / LIMIT);\n  }\n\n  @action setPage = (page: number) => {\n    this.page = page;\n  }\n\n  @action createHubConnection = () => {\n    this.hubConnection = new HubConnectionBuilder()\n      .withUrl(process.env.REACT_APP_API_CHAT_URL!, {\n        accessTokenFactory: () => this.rootStore.commonStore.token!\n      })\n      .configureLogging(LogLevel.Information)\n      .build();\n\n    this.hubConnection\n      .start()\n      .then(() => console.log(this.hubConnection!.state))\n      .catch(error => console.log('Error establishing connection: ', error));\n\n  };\n\n  @action stopHubConnection = () => {\n    this.hubConnection!.stop()\n  }\n\n\n\n  @computed get affiliesByDate() {\n    return this.groupAffiliesByDate(\n      Array.from(this.affilieRegistry.values())\n    );\n  }\n\n  groupAffiliesByDate(affilies: IAffilie[]) {\n    const sortedAffilies = affilies\n    return Object.entries(\n      sortedAffilies.reduce(\n        (affilies, affilie) => {\n          const date = affilie.DateNaissance.toISOString().split('T')[0];\n          affilies[date] = affilies[date]\n            ? [...affilies[date], affilie]\n            : [affilie];\n          return affilies;\n        },\n        {} as { [key: string]: IAffilie[] }\n      )\n    );\n  }\n\n  @action loadAffilies = async () => {\n    this.loadingInitial = true;\n    try {\n      const affiliesEnvelope = await agent.Affilies.list(this.axiosParams);\n      const {affilies, affilieCount} = affiliesEnvelope;\n      runInAction('loading affilies', () => {\n        affilies.forEach(affilie => {\n          setAffilieProps(affilie, this.rootStore.userStore.user!);\n          this.affilieRegistry.set(affilie.Cin, affilie);\n        });\n        this.affilieCount = affilieCount;\n        this.loadingInitial = false;\n      });\n    } catch (error) {\n      runInAction('load affilies error', () => {\n        this.loadingInitial = false;\n      });\n    }\n  };\n\n\n\n\n\n\n\n\n\n\n\n}\n"]},"metadata":{},"sourceType":"module"}