{"ast":null,"code":"import _initializerDefineProperty from \"/Users/abdelilah/Desktop/App/client-app/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _applyDecoratedDescriptor from \"/Users/abdelilah/Desktop/App/client-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"/Users/abdelilah/Desktop/App/client-app/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper\";\n\nvar _dec, _class, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _temp;\n\nimport { observable, action, computed, runInAction, reaction, toJS } from 'mobx';\nimport agent from '../api/agent';\nimport { setAffilieProps } from '../common/util/util';\nconst LIMIT = 10;\nlet AffilieStore = (_dec = observable.ref, (_class = (_temp = class AffilieStore {\n  constructor(rootStore) {\n    this.rootStore = void 0;\n\n    _initializerDefineProperty(this, \"affilieRegistry\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"affilie\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"loadingInitial\", _descriptor3, this);\n\n    _initializerDefineProperty(this, \"submitting\", _descriptor4, this);\n\n    _initializerDefineProperty(this, \"target\", _descriptor5, this);\n\n    _initializerDefineProperty(this, \"loading\", _descriptor6, this);\n\n    _initializerDefineProperty(this, \"hubConnection\", _descriptor7, this);\n\n    _initializerDefineProperty(this, \"affilieCount\", _descriptor8, this);\n\n    _initializerDefineProperty(this, \"page\", _descriptor9, this);\n\n    _initializerDefineProperty(this, \"predicate\", _descriptor10, this);\n\n    _initializerDefineProperty(this, \"setPredicate\", _descriptor11, this);\n\n    _initializerDefineProperty(this, \"setPage\", _descriptor12, this);\n\n    _initializerDefineProperty(this, \"loadAffilies\", _descriptor13, this);\n\n    this.getAffilie = cin => {\n      return this.affilieRegistry.get(cin);\n    };\n\n    _initializerDefineProperty(this, \"loadAffilie\", _descriptor14, this);\n\n    this.rootStore = rootStore;\n    reaction(() => this.predicate.keys(), () => {\n      this.page = 0;\n      this.affilieRegistry.clear();\n      this.loadAffilies();\n    });\n  }\n\n  get axiosParams() {\n    const params = new URLSearchParams();\n    params.append('limit', String(LIMIT));\n    params.append('offset', \"\".concat(this.page ? this.page * LIMIT : 0));\n    this.predicate.forEach((value, key) => {\n      if (key === 'startDate') {\n        params.append(key, value.toISOString());\n      } else {\n        params.append(key, value);\n      }\n    });\n    return params;\n  }\n\n  get totalPages() {\n    return Math.ceil(this.affilieCount / LIMIT);\n  }\n\n  get affiliesByDate() {\n    return this.groupAffiliesByDate(Array.from(this.affilieRegistry.values()));\n  }\n\n  groupAffiliesByDate(affilies) {\n    const sortedAffilies = affilies;\n    return Object.entries(sortedAffilies.reduce((affilies, affilie) => {\n      const date = affilie.dateNaissance.toISOString().split('T')[0];\n      affilies[date] = affilies[date] ? [...affilies[date], affilie] : [affilie];\n      return affilies;\n    }, {}));\n  }\n\n}, _temp), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"affilieRegistry\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return new Map();\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"affilie\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return null;\n  }\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"loadingInitial\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor4 = _applyDecoratedDescriptor(_class.prototype, \"submitting\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor5 = _applyDecoratedDescriptor(_class.prototype, \"target\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return '';\n  }\n}), _descriptor6 = _applyDecoratedDescriptor(_class.prototype, \"loading\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), _descriptor7 = _applyDecoratedDescriptor(_class.prototype, \"hubConnection\", [_dec], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return null;\n  }\n}), _descriptor8 = _applyDecoratedDescriptor(_class.prototype, \"affilieCount\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0;\n  }\n}), _descriptor9 = _applyDecoratedDescriptor(_class.prototype, \"page\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0;\n  }\n}), _descriptor10 = _applyDecoratedDescriptor(_class.prototype, \"predicate\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return new Map();\n  }\n}), _descriptor11 = _applyDecoratedDescriptor(_class.prototype, \"setPredicate\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return (predicate, value) => {\n      this.predicate.clear();\n\n      if (predicate !== 'all') {\n        this.predicate.set(predicate, value);\n      }\n    };\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"axiosParams\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"axiosParams\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"totalPages\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"totalPages\"), _class.prototype), _descriptor12 = _applyDecoratedDescriptor(_class.prototype, \"setPage\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return page => {\n      this.page = page;\n    };\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"affiliesByDate\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"affiliesByDate\"), _class.prototype), _descriptor13 = _applyDecoratedDescriptor(_class.prototype, \"loadAffilies\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async () => {\n      this.loadingInitial = true;\n\n      try {\n        const affiliesEnvelope = await agent.Affilies.list(this.axiosParams);\n        const affilies = affiliesEnvelope.affilies,\n              affilieCount = affiliesEnvelope.affilieCount; //console.log(affiliesEnvelope)\n\n        runInAction('loading affilies', () => {\n          affilies.forEach(affilie => {\n            setAffilieProps(affilie);\n            this.affilieRegistry.set(affilie.cin, affilie);\n          });\n          this.affilieCount = affilieCount;\n          this.loadingInitial = false;\n        });\n      } catch (error) {\n        runInAction('load affilies error', () => {\n          this.loadingInitial = false;\n        });\n      }\n    };\n  }\n}), _descriptor14 = _applyDecoratedDescriptor(_class.prototype, \"loadAffilie\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return async cin => {\n      let affilie = this.getAffilie(cin);\n\n      if (affilie) {\n        this.affilie = affilie;\n        return toJS(affilie);\n      } else {\n        this.loadingInitial = true;\n\n        try {\n          affilie = await agent.Affilies.details(cin);\n          runInAction('getting affilie', () => {\n            setAffilieProps(affilie);\n            this.affilie = affilie;\n            this.affilieRegistry.set(affilie.cin, affilie);\n            this.loadingInitial = false;\n          });\n          return affilie;\n        } catch (error) {\n          runInAction('get affilie error', () => {\n            this.loadingInitial = false;\n          });\n          console.log(error);\n        }\n      }\n    };\n  }\n})), _class));\nexport { AffilieStore as default };","map":{"version":3,"sources":["/Users/abdelilah/Desktop/App/client-app/src/app/stores/affiliesStore.ts"],"names":["observable","action","computed","runInAction","reaction","toJS","agent","setAffilieProps","LIMIT","AffilieStore","ref","constructor","rootStore","getAffilie","cin","affilieRegistry","get","predicate","keys","page","clear","loadAffilies","axiosParams","params","URLSearchParams","append","String","forEach","value","key","toISOString","totalPages","Math","ceil","affilieCount","affiliesByDate","groupAffiliesByDate","Array","from","values","affilies","sortedAffilies","Object","entries","reduce","affilie","date","dateNaissance","split","Map","set","loadingInitial","affiliesEnvelope","Affilies","list","error","details","console","log"],"mappings":"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","sourcesContent":["import { observable, action, computed, runInAction, reaction, toJS } from 'mobx';\n\nimport agent from '../api/agent';\nimport { RootStore } from './rootStore';\nimport { setAffilieProps } from '../common/util/util';\nimport { HubConnection } from '@aspnet/signalr';\nimport { IAffilie } from '../models/affilie';\n\n\nconst LIMIT = 10;\n\nexport default class AffilieStore {\n  rootStore: RootStore;\n\n  constructor(rootStore: RootStore) {\n    this.rootStore = rootStore;\n\n    reaction(\n      () => this.predicate.keys(),\n      () => {\n        this.page = 0;\n        this.affilieRegistry.clear();\n        this.loadAffilies();\n      }\n    )\n  }\n\n  @observable affilieRegistry = new Map();\n  @observable affilie: IAffilie | null = null;\n  @observable loadingInitial = false;\n  @observable submitting = false;\n  @observable target = '';\n  @observable loading = false;\n  @observable.ref hubConnection: HubConnection | null = null;\n  @observable affilieCount = 0;\n  @observable page = 0;\n  @observable predicate = new Map();\n\n  @action setPredicate = (predicate: string, value: string | Date) => {\n    this.predicate.clear();\n    if (predicate !== 'all') {\n      this.predicate.set(predicate, value);\n    }\n  }\n\n  @computed get axiosParams() {\n    const params = new URLSearchParams();\n    params.append('limit', String(LIMIT));\n    params.append('offset', `${this.page ? this.page * LIMIT : 0}`);\n    this.predicate.forEach((value, key) => {\n      if (key === 'startDate') {\n        params.append(key, value.toISOString())\n      } else {\n        params.append(key, value)\n      }\n    })\n    return params;\n  }\n\n  @computed get totalPages() {\n    return Math.ceil(this.affilieCount / LIMIT);\n  }\n\n  @action setPage = (page: number) => {\n    this.page = page;\n  }\n\n\n\n  @computed get affiliesByDate() {\n    return this.groupAffiliesByDate(\n      Array.from(this.affilieRegistry.values())\n    ); \n   \n  }\n\n  groupAffiliesByDate(affilies: IAffilie[]) {\n     const sortedAffilies = affilies\n    return Object.entries(\n      sortedAffilies.reduce(\n        (affilies, affilie) => {\n          const date = affilie.dateNaissance.toISOString().split('T')[0];\n          affilies[date] = affilies[date]\n            ? [...affilies[date], affilie]\n            : [affilie];\n          return affilies;\n        },\n        {} as { [key: string]: IAffilie[] }\n      )\n    ); \n  }\n\n  @action loadAffilies = async () => {\n  \n    this.loadingInitial = true;\n    try {\n      const affiliesEnvelope = await agent.Affilies.list(this.axiosParams);\n      const {affilies, affilieCount} = affiliesEnvelope;\n      //console.log(affiliesEnvelope)\n  \n      runInAction('loading affilies', () => {\n        affilies.forEach(affilie => {\n          setAffilieProps(affilie);\n          this.affilieRegistry.set(affilie.cin, affilie);\n        });\n        this.affilieCount = affilieCount;\n        this.loadingInitial = false;\n      });\n    } catch (error) {\n      runInAction('load affilies error', () => {\n        this.loadingInitial = false;\n      });\n    }\n  };\n\n  getAffilie = (cin: string) => {\n    return this.affilieRegistry.get(cin);\n  };\n\n  @action loadAffilie = async (cin: string) => {\n    let affilie = this.getAffilie(cin);\n    if (affilie) {\n      this.affilie = affilie;\n      return toJS(affilie);\n    } else {\n      this.loadingInitial = true;\n      try {\n        affilie = await agent.Affilies.details(cin);\n        runInAction('getting affilie', () => {\n          setAffilieProps(affilie);\n          this.affilie = affilie;\n          this.affilieRegistry.set(affilie.cin, affilie);\n          this.loadingInitial = false;\n        });\n        return affilie;\n      } catch (error) {\n        runInAction('get affilie error', () => {\n          this.loadingInitial = false;\n        });\n        console.log(error);\n      }\n    }\n  };\n\n\n\n\n\n\n\n\n\n\n\n}\n"]},"metadata":{},"sourceType":"module"}